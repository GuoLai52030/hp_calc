<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è¡€æœˆç”Ÿå­˜å‹åŠ›æ¨¡æ‹Ÿå™¨</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --cyan: #00e5ff; --gold: #ff9f43; --red: #ff5252; --bg: #121212; }
        body { font-family: sans-serif; background: var(--bg); color: #fff; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; display: grid; grid-template-columns: 320px 1fr; gap: 20px; }
        .panel { background: #1e1e1e; padding: 20px; border-radius: 12px; border: 1px solid #333; }
        .input-group { margin-bottom: 20px; }
        label { display: block; font-size: 0.85em; color: #888; margin-bottom: 8px; }
        input[type=range] { width: 100%; accent-color: var(--cyan); cursor: pointer; }
        .val { float: right; color: var(--cyan); font-family: monospace; font-weight: bold; }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-card { background: #000; padding: 15px; border-radius: 10px; border-top: 3px solid var(--cyan); }
        .stat-title { font-size: 0.7em; color: #666; text-transform: uppercase; }
        .stat-num { font-size: 1.6em; font-family: monospace; }

        .status-banner { padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; margin-bottom: 20px; border: 1px solid #444; }
        .pass { background: rgba(0, 229, 255, 0.1); color: var(--cyan); border-color: var(--cyan); }
        .fail { background: rgba(255, 82, 82, 0.1); color: var(--red); border-color: var(--red); }
        
        .info-text { font-size: 0.85em; color: #aaa; line-height: 1.6; }
        .highlight { color: #fff; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="panel">
        <h3 style="margin-top:0">ğŸ›ï¸ å®æ—¶å‚æ•°æ§åˆ¶</h3>
        
        <div class="input-group">
            <label>è¡€æœˆç­‰çº§ (L) <span id="lVal" class="val">0</span></label>
            <input type="range" id="lSlider" min="0" max="300" value="0">
        </div>

        <div class="input-group">
            <label>æ€ªç‰©æ•°é‡ (N) <span id="nVal" class="val">1</span></label>
            <input type="range" id="nSlider" min="1" max="50" value="1">
        </div>

        <div class="input-group">
            <label>è¯ç¼€å¢ä¼¤ç´¯è®¡ (%) <span id="bVal" class="val">0</span></label>
            <input type="range" id="bSlider" min="0" max="1000" value="0" step="10">
        </div>

        <div class="input-group">
            <label>ç©å®¶èµ°ä½è§„é¿ç‡ (%) <span id="dVal" class="val">0</span></label>
            <input type="range" id="dSlider" min="0" max="95" value="0">
        </div>

        <div class="info-text" style="border-top:1px solid #333; padding-top:15px;">
            <p>åŸºç¡€è®¾å®šï¼š<br>
            â€¢ å±€å¤–ATK: <span class="highlight">42</span><br>
            â€¢ å±€å†…åˆå§‹: <span class="highlight">122</span><br>
            â€¢ ç©å®¶è¡€é‡: <span class="highlight">100</span><br>
            â€¢ æ€ªç‰©æ”»å‡»: <span class="highlight">30</span></p>
        </div>
    </div>

    <div class="panel">
        <div id="statusBanner" class="status-banner fail">æ•°å€¼å´©åï¼šæ— æ³•ç”Ÿå­˜</div>

        <div class="stat-grid">
            <div class="stat-card">
                <div class="stat-title">å±€å†…æ€»æ”»å‡»åŠ›</div>
                <div id="atkIn" class="stat-num">122</div>
            </div>
            <div class="stat-card" style="border-top-color: var(--gold);">
                <div class="stat-title">å®æ—¶æš´å‡»ä¼¤å®³</div>
                <div id="critDmg" class="stat-num">202</div>
            </div>
            <div class="stat-card" style="border-top-color: #aaa;">
                <div class="stat-title">ç”Ÿå­˜å€’è®¡æ—¶ (T_die)</div>
                <div id="tDie" class="stat-num">3.33s</div>
            </div>
            <div class="stat-card" style="border-top-color: #888;">
                <div class="stat-title">æ€ªç‰©æ€»è¡€é‡ (HP*N)</div>
                <div id="totalHp" class="stat-num">3,703</div>
            </div>
        </div>

        <canvas id="chart" height="180"></canvas>
    </div>
</div>

<script>
    const lS = document.getElementById('lSlider');
    const nS = document.getElementById('nSlider');
    const bS = document.getElementById('bSlider');
    const dS = document.getElementById('dSlider');
    const ctx = document.getElementById('chart').getContext('2d');

    // æ€ªç‰©è¡€é‡åˆ†æ®µå‡½æ•°
    function getHP(L) {
        if (L <= 100) return 3703 + 24.57 * L;
        if (L <= 200) return 6160 + 262.68 * (L - 100);
        return 32428 + 383.48 * (L - 200);
    }

    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: Array.from({length: 31}, (_, i) => i * 10),
            datasets: [{
                label: 'æ¸…åœºæ‰€éœ€æœ€å°æ”»å‡»åŠ›',
                data: [],
                borderColor: '#444',
                borderWidth: 1,
                pointRadius: 0,
                fill: false
            }, {
                label: 'å½“å‰æ”»å‡»åŠ›',
                data: [],
                borderColor: '#00e5ff',
                backgroundColor: 'rgba(0, 229, 255, 0.1)',
                fill: true,
                pointRadius: 0
            }]
        },
        options: {
            plugins: { legend: { display: false } },
            scales: { 
                y: { type: 'logarithmic', grid: { color: '#333' } },
                x: { ticks: { color: '#666' } }
            }
        }
    });

    function update() {
        const L = parseInt(lS.value);
        const N = parseInt(nS.value);
        const B = parseInt(bS.value) / 100;
        const D = parseInt(dS.value) / 100;

        // 1. ä¸¥æ ¼æ‹Ÿåˆæ”»å‡»åŠ›å…¬å¼
        const atkIn = 42 + 80 * (1 + B);
        // 2. ä¸¥æ ¼æ‹Ÿåˆæš´å‡»å…¬å¼
        const crit = 2 * atkIn - 42;

        // 3. ç”Ÿå­˜åˆ¤å®šé€»è¾‘
        const mHP = getHP(L);
        const totalMonsterHP = mHP * N;
        const actualMonsterDPS = (N * 30) * (1 - D); // è€ƒè™‘è§„é¿ç‡
        const tDie = actualMonsterDPS > 0 ? 100 / actualMonsterDPS : 999;
        
        // æ¸…åœºéœ€è¦çš„æ—¶é—´ (å‡è®¾1ç§’1æ‰“)
        const tKill = totalMonsterHP / atkIn;
        const reqAtk = totalMonsterHP / tDie;

        // UI æ›´æ–°
        document.getElementById('lVal').innerText = L;
        document.getElementById('nVal').innerText = N;
        document.getElementById('bVal').innerText = (B * 100).toFixed(0) + '%';
        document.getElementById('dVal').innerText = (D * 100).toFixed(0) + '%';
        
        document.getElementById('atkIn').innerText = Math.round(atkIn).toLocaleString();
        document.getElementById('critDmg').innerText = Math.round(crit).toLocaleString();
        document.getElementById('tDie').innerText = tDie === 999 ? "âˆ" : tDie.toFixed(2) + "s";
        document.getElementById('totalHp').innerText = Math.round(totalMonsterHP).toLocaleString();

        const banner = document.getElementById('statusBanner');
        if (atkIn >= reqAtk) {
            banner.className = "status-banner pass";
            banner.innerText = "æ•°å€¼è¾¾æ ‡ï¼šé…åˆèµ°ä½å¯ä»¥ç”Ÿå­˜";
        } else {
            banner.className = "status-banner fail";
            banner.innerText = `æ•°å€¼å´©åï¼šå»ºè®®æœ€å°æ”»å‡»åŠ› ${Math.round(reqAtk).toLocaleString()}`;
        }

        // å›¾è¡¨æ›´æ–°ï¼šå±•ç¤ºå…¨ç­‰çº§å‹åŠ›çº¿
        chart.data.datasets[0].data = Array.from({length: 31}, (_, i) => (getHP(i * 10) * N) / tDie);
        chart.data.datasets[1].data = Array(31).fill(atkIn);
        chart.update('none');
    }

    [lS, nS, bS, dS].forEach(s => s.addEventListener('input', update));
    update();
</script>
</body>
</html>
